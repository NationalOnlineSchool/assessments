<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Staff Screening Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .likert-cell { transition: background-color .15s ease, border-color .15s ease; }
    .likert-cell.selected { background-color: #eff6ff; border-color: #3b82f6; font-weight: 600; }
    @media print {
      .no-print { display: none !important; }
      body { background: white !important; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-4xl">

    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">Staff Screening Tool</h1>
      <p class="text-lg text-gray-600">Rate each statement using the scale. Be as accurate as possible.</p>
    </div>

    <!-- Staff / Student Information -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Assessment Information</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="studentName" class="block text-sm font-medium text-gray-700 mb-2">Student Name</label>
          <input id="studentName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Student being rated"/>
        </div>
        <div>
          <label for="staffName" class="block text-sm font-medium text-gray-700 mb-2">Staff Name</label>
          <input id="staffName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Your name"/>
        </div>
        <div>
          <label for="staffRole" class="block text-sm font-medium text-gray-700 mb-2">Role</label>
          <input id="staffRole" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., TAP, Teacher"/>
        </div>
        <div>
          <label for="assessmentDate" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
          <input id="assessmentDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/>
        </div>
        <div>
          <label for="assessmentType" class="block text-sm font-medium text-gray-700 mb-2">Assessment Type</label>
          <select id="assessmentType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">Select type</option>
            <option value="pre">Pre-Intervention</option>
            <option value="post">Post-Intervention</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Assessment Form -->
    <div id="assessmentForm" class="space-y-8">
      <!-- Domains inserted here -->
    </div>

    <!-- Submit Button -->
    <div id="submitSection" class="text-center mt-12 no-print">
      <button id="submitBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-8 rounded-lg text-lg transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
        Complete Assessment
      </button>
    </div>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden mt-12 space-y-8">
      <div class="bg-white rounded-xl shadow-lg p-8">
        <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Results</h2>

        <!-- Info -->
        <div id="infoDisplay" class="bg-gray-50 p-4 rounded-lg mb-6"></div>

        <!-- Overall Score -->
        <div id="overallScore" class="text-center mb-8 p-6 rounded-lg"></div>

        <!-- Domain Scores Table -->
        <div class="overflow-x-auto mb-8">
          <table class="w-full border-collapse bg-white rounded-lg overflow-hidden shadow-sm">
            <thead class="bg-gray-50">
              <tr>
                <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">Domain</th>
                <th class="border border-gray-200 px-4 py-3 text-center font-semibold text-gray-700">Score</th>
                <th class="border border-gray-200 px-4 py-3 text-center font-semibold text-gray-700">Max</th>
              </tr>
            </thead>
            <tbody id="domainScoresTable"></tbody>
          </table>
        </div>

        <!-- Domain Likert Matrices (full width) -->
        <div id="domainBreakdown" class="space-y-6 mb-8"></div>

        <!-- Raw Scores -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-gray-700 mb-2">Raw Scores (CSV Format):</h3>
          <div class="bg-gray-50 p-4 rounded-lg border">
            <code id="rawScores" class="text-sm text-gray-600 break-all"></code>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex flex-wrap gap-4 justify-center no-print">
          <button id="printBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-md">
            Print to PDF
          </button>
          <button id="copyBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-md">
            Copy CSV Data
          </button>
          <button id="retakeBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-md">
            Retake Assessment
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ------------ Data (from your PDF) ------------ */
    const scale = [
      { value: 1, label: "Never true" },
      { value: 2, label: "Sometimes true" },
      { value: 3, label: "Often true" },
      { value: 4, label: "Always true" }
    ]; // :contentReference[oaicite:1]{index=1}

    const domains = [
      {
        title: "Self-Esteem and Self-Concept",
        statements: [
          "The student can show confidence in their identity and individuality",
          "The student can recognise and talk about their strengths",
          "The student can take pride in their efforts and achievements",
          "The student can accept mistakes without emotional difficulty",
          "The student can feel secure without comparing themselves to others"
        ] // :contentReference[oaicite:2]{index=2}
      },
      {
        title: "Emotional Awareness and Anxiety Management",
        statements: [
          "The student can identify and describe their emotional states",
          "The student can identify or use calming strategies",
          "The student can manage signs of overwhelm",
          "The student can request support when feeling anxious or stressed",
          "The student can use self-regulation tools when needed"
        ] // :contentReference[oaicite:3]{index=3}
      },
      {
        title: "Emotional Literacy and Regulation",
        statements: [
          "The student can recognise rising frustration or anger",
          "The student can adjust their behaviour in moments of challenge",
          "The student can express strong feelings in appropriate ways",
          "The student can use strategies to manage big emotions",
          "The student can remain calm in frustrating situations"
        ] // :contentReference[oaicite:4]{index=4}
      },
      {
        title: "Readiness for Learning",
        statements: [
          "The student can show readiness to engage in learning",
          "The student can remain focused on tasks",
          "The student can manage distractions in an online setting",
          "The student can show motivation to participate",
          "The student can seek clarification or ask for support when needed"
        ] // :contentReference[oaicite:5]{index=5}
      },
      {
        title: "Social and Communication Skills",
        statements: [
          "The student can initiate or respond to communication appropriately",
          "The student can take turns and listen to others",
          "The student can recognise and respond to others’ emotions or perspectives",
          "The student can engage in group activities or discussions",
          "The student can communicate ideas clearly"
        ] // :contentReference[oaicite:6]{index=6}
      },
      {
        title: "Executive Functioning and Adaptability",
        statements: [
          "The student can plan and organise tasks effectively",
          "The student can manage their time independently",
          "The student can initiate tasks and follow them through to completion",
          "The student can adapt to changes in routine or expectations",
          "The student can transition between activities without significant difficulty"
        ] // :contentReference[oaicite:7]{index=7}
      },
      {
        title: "Resilience and Coping Skills",
        statements: [
          "The student can recover from setbacks or disappointments with support",
          "The student can express when they need help in a clear and consistent way",
          "The student can keep trying when a task or situation feels challenging",
          "The student can manage when things do not go as expected",
          "The student can hold on to hope or optimism during difficult times"
        ] // :contentReference[oaicite:8]{index=8}
      }
    ];

    /* ------------ State + Cookies ------------ */
    let responses = {}; // { [domainIndex]: { [statementIndex]: value } }

    const COOKIE_NAME = "staff_screener_state";
    function setCookie(name, value, days) {
      const expires = new Date(Date.now() + days * 864e5).toUTCString();
      document.cookie = name + "=" + encodeURIComponent(value) + "; expires=" + expires + "; path=/";
    }
    function getCookie(name) {
      const v = document.cookie.split("; ").find(row => row.startsWith(name + "="));
      return v ? decodeURIComponent(v.split("=")[1]) : null;
    }
    function eraseCookie(name) {
      document.cookie = name + "=; Max-Age=0; path=/";
    }
    function saveState() {
      const data = {
        studentName: document.getElementById("studentName").value,
        staffName: document.getElementById("staffName").value,
        staffRole: document.getElementById("staffRole").value,
        assessmentDate: document.getElementById("assessmentDate").value,
        assessmentType: document.getElementById("assessmentType").value,
        responses
      };
      try { setCookie(COOKIE_NAME, JSON.stringify(data), 30); } catch(e){}
    }
    function loadState() {
      const raw = getCookie(COOKIE_NAME);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        if (data.studentName) document.getElementById("studentName").value = data.studentName;
        if (data.staffName) document.getElementById("staffName").value = data.staffName;
        if (data.staffRole) document.getElementById("staffRole").value = data.staffRole;
        if (data.assessmentDate) document.getElementById("assessmentDate").value = data.assessmentDate;
        if (data.assessmentType) document.getElementById("assessmentType").value = data.assessmentType;
        if (data.responses) responses = data.responses;
      } catch(e){}
    }

    /* ------------ Form Rendering ------------ */
    function renderDomain(domain, domainIndex) {
      // Likert header row
      const header = `
        <div class="grid grid-cols-5">
          <div class="bg-gray-50 px-3 py-2 font-semibold text-sm text-left border border-gray-200">Statement</div>
          ${scale.map(opt => `
            <div class="bg-gray-50 px-3 py-2 font-semibold text-sm text-center border border-gray-200">
              <div class="leading-none">${opt.label}</div>
              <div class="text-[10px] text-gray-600 mt-1">${opt.value}</div>
            </div>
          `).join("")}
        </div>
      `;

      // Rows
      const rows = domain.statements.map((statement, statementIndex) => {
        const rowCells = scale.map(opt => {
          const selected = responses?.[domainIndex]?.[statementIndex] === opt.value;
          return `
            <button type="button"
              class="likert-cell px-3 py-2 text-center border border-gray-200 ${selected ? "selected" : "text-gray-400"}"
              data-domain="${domainIndex}"
              data-statement="${statementIndex}"
              data-value="${opt.value}">
              ${selected ? `<div>${opt.value}</div>` : "•"}
            </button>
          `;
        }).join("");

        return `
          <div class="grid grid-cols-5">
            <div class="px-3 py-2 text-sm border border-gray-200 text-gray-800">${statement}</div>
            ${rowCells}
          </div>
        `;
      }).join("");

      return `
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
          <div class="px-4 pt-4 pb-2">
            <h3 class="text-lg font-semibold text-gray-800">Domain ${domainIndex + 1}: ${domain.title}</h3>
          </div>
          <div class="px-0 pb-4">${header}${rows}</div>
        </div>
      `;
    }

    function createAssessmentForm() {
      const form = document.getElementById("assessmentForm");
      form.innerHTML = domains.map(renderDomain).join("");
      // Re-apply selections from cookie
      Object.keys(responses).forEach(d => {
        Object.keys(responses[d]).forEach(s => {
          const v = responses[d][s];
          const btn = document.querySelector(`.likert-cell[data-domain="${d}"][data-statement="${s}"][data-value="${v}"]`);
          if (btn) {
            btn.parentElement.querySelectorAll(".likert-cell").forEach(x => x.classList.remove("selected","text-gray-400"));
            btn.classList.add("selected");
          }
        });
      });
    }

    /* ------------ Interaction ------------ */
    document.addEventListener("click", (e) => {
      const cell = e.target.closest(".likert-cell");
      if (!cell) return;
      const domain = parseInt(cell.dataset.domain, 10);
      const statement = parseInt(cell.dataset.statement, 10);
      const value = parseInt(cell.dataset.value, 10);

      // Deselect siblings in the row, select this one
      cell.parentElement.querySelectorAll(".likert-cell").forEach(x => x.classList.remove("selected","text-gray-400"));
      cell.classList.add("selected");

      if (!responses[domain]) responses[domain] = {};
      responses[domain][statement] = value;

      saveState();
      updateSubmitButton();
    });

    function updateSubmitButton() {
      const totalQuestions = domains.length * 5;
      let answered = 0;
      for (const d in responses) { answered += Object.keys(responses[d]).length; }

      const nameOk = document.getElementById("studentName").value.trim();
      const staffOk = document.getElementById("staffName").value.trim();
      const roleOk = document.getElementById("staffRole").value.trim();
      const dateOk = document.getElementById("assessmentDate").value;
      const typeOk = document.getElementById("assessmentType").value;

      const submitBtn = document.getElementById("submitBtn");
      const allQ = answered === totalQuestions;
      const allInfo = nameOk && staffOk && roleOk && dateOk && typeOk;

      if (allQ && allInfo) {
        submitBtn.disabled = false;
        submitBtn.textContent = "Complete Assessment";
      } else {
        submitBtn.disabled = true;
        const missing = [];
        if (!allInfo) missing.push("info");
        if (!allQ) missing.push(`${totalQuestions - answered} items`);
        submitBtn.textContent = `Complete Assessment (Missing: ${missing.join(", ")})`;
      }

      saveState();
    }

    function calculateResults() {
      const domainScores = [];
      let totalScore = 0;
      const rawScores = [];

      domains.forEach((domain, dIdx) => {
        let subtotal = 0;
        domain.statements.forEach((_, sIdx) => {
          const v = responses?.[dIdx]?.[sIdx] ?? 0;
          subtotal += v;
          rawScores.push(v);
        });
        domainScores.push({ title: domain.title, score: subtotal, max: 20 });
        totalScore += subtotal;
      });

      return { domainScores, totalScore, rawScores };
    }

    function displayResults() {
      const { domainScores, totalScore, rawScores } = calculateResults();

      // Info
      const info = document.getElementById("infoDisplay");
      const studentName = document.getElementById("studentName").value.trim();
      const staffName = document.getElementById("staffName").value.trim();
      const staffRole = document.getElementById("staffRole").value.trim();
      const date = document.getElementById("assessmentDate").value;
      const type = document.getElementById("assessmentType").value;

      info.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 text-center md:text-left">
          <div><span class="font-semibold text-gray-700">Student:</span><div class="text-lg font-medium text-gray-900">${studentName}</div></div>
          <div><span class="font-semibold text-gray-700">Staff:</span><div class="text-lg font-medium text-gray-900">${staffName}</div></div>
          <div><span class="font-semibold text-gray-700">Role:</span><div class="text-lg font-medium text-gray-900">${staffRole}</div></div>
          <div><span class="font-semibold text-gray-700">Date:</span><div class="text-lg font-medium text-gray-900">${new Date(date).toLocaleDateString()}</div></div>
          <div><span class="font-semibold text-gray-700">Type:</span><div class="text-lg font-medium text-gray-900">${type === "pre" ? "Pre-Intervention" : "Post-Intervention"}</div></div>
        </div>
      `;

      // Hide form, show results
      document.getElementById("assessmentForm").style.display = "none";
      document.getElementById("submitSection").style.display = "none";
      document.getElementById("resultsSection").classList.remove("hidden");

      // Overall thresholds (same as student): Green ≥106, Yellow 71–105, Red ≤70
      const overallDiv = document.getElementById("overallScore");
      let message, bg, fg;
      if (totalScore >= 106) {
        message = "Doing well";
        bg = "bg-green-100"; fg = "text-green-800";
      } else if (totalScore >= 71) {
        message = "Some areas of support";
        bg = "bg-yellow-100"; fg = "text-yellow-800";
      } else {
        message = "Lots of areas of support";
        bg = "bg-red-100"; fg = "text-red-800";
      }
      overallDiv.innerHTML = `
        <div class="${bg} ${fg} p-6 rounded-lg">
          <div class="text-3xl font-bold mb-2">Total Score: ${totalScore}/140</div>
          <div class="text-lg">${message}</div>
        </div>
      `;

      // Domain table
      const tbody = document.getElementById("domainScoresTable");
      tbody.innerHTML = domainScores.map((d, i) => `
        <tr class="${i % 2 === 0 ? "bg-gray-50" : "bg-white"}">
          <td class="border border-gray-200 px-4 py-3 font-medium">Domain ${i + 1}: ${d.title}</td>
          <td class="border border-gray-200 px-4 py-3 text-center font-semibold">${d.score}</td>
          <td class="border border-gray-200 px-4 py-3 text-center">20</td>
        </tr>
      `).join("");

      // Domain matrices (selected cell highlighted)
      const breakdown = document.getElementById("domainBreakdown");
      breakdown.innerHTML = domains.map((domain, dIdx) => {
        const header = `
          <div class="grid grid-cols-5">
            <div class="bg-gray-50 px-3 py-2 font-semibold text-sm text-left border border-gray-200">Statement</div>
            ${scale.map(opt => `
              <div class="bg-gray-50 px-3 py-2 font-semibold text-sm text-center border border-gray-200">
                <div>${opt.label}</div>
                <div class="text-[10px] text-gray-600 mt-1">${opt.value}</div>
              </div>
            `).join("")}
          </div>
        `;
        const rows = domain.statements.map((s, sIdx) => {
          const selectedVal = responses?.[dIdx]?.[sIdx];
          const cells = scale.map(opt => {
            const sel = opt.value === selectedVal;
            return `
              <div class="px-3 py-2 text-center border border-gray-200 ${sel ? "bg-blue-50 font-semibold" : "text-gray-300"}">
                ${sel ? `<div>${opt.value}</div>` : "•"}
              </div>
            `;
          }).join("");
          return `
            <div class="grid grid-cols-5">
              <div class="px-3 py-2 text-sm border border-gray-200 text-gray-800">${s}</div>
              ${cells}
            </div>
          `;
        }).join("");

        return `
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-4 pt-4 pb-2">
              <h4 class="text-md font-semibold text-gray-800">Domain ${dIdx + 1}: ${domain.title}</h4>
            </div>
            <div class="px-0 pb-4">
              ${header}
              ${rows}
            </div>
          </div>
        `;
      }).join("");

      // CSV (raw scores only to match student tool)
      document.getElementById("rawScores").textContent = rawScores.join(",");
    }

    function printToPDF() { window.print(); }

    function copyCSVData() {
      const { rawScores } = calculateResults();
      const csv = rawScores.join(",");
      navigator.clipboard.writeText(csv).then(() => {
        const btn = document.getElementById("copyBtn");
        const orig = btn.textContent;
        btn.textContent = "Copied!";
        btn.classList.remove("bg-purple-600","hover:bg-purple-700");
        btn.classList.add("bg-green-600","hover:bg-green-700");
        setTimeout(() => {
          btn.textContent = orig;
          btn.classList.remove("bg-green-600","hover:bg-green-700");
          btn.classList.add("bg-purple-600","hover:bg-purple-700");
        }, 1500);
      });
    }

    function retakeAssessment() {
      responses = {};
      eraseCookie(COOKIE_NAME);

      document.getElementById("resultsSection").classList.add("hidden");
      document.getElementById("assessmentForm").style.display = "block";
      document.getElementById("submitSection").style.display = "block";

      // Clear info fields (keep today's date)
      document.getElementById("studentName").value = "";
      document.getElementById("staffName").value = "";
      document.getElementById("staffRole").value = "";
      document.getElementById("assessmentDate").value = new Date().toISOString().split("T")[0];
      document.getElementById("assessmentType").value = "";

      // Re-render clean form
      createAssessmentForm();
      updateSubmitButton();
      window.scrollTo(0, 0);
    }

    // Buttons
    document.getElementById("submitBtn").addEventListener("click", displayResults);
    document.getElementById("printBtn").addEventListener("click", printToPDF);
    document.getElementById("copyBtn").addEventListener("click", copyCSVData);
    document.getElementById("retakeBtn").addEventListener("click", retakeAssessment);

    // Info persistence
    ["studentName","staffName","staffRole","assessmentDate","assessmentType"].forEach(id => {
      document.getElementById(id).addEventListener("input", () => { saveState(); updateSubmitButton(); });
      document.getElementById(id).addEventListener("change", () => { saveState(); updateSubmitButton(); });
    });

    // Init
    document.getElementById("assessmentDate").value = new Date().toISOString().split("T")[0];
    loadState();
    createAssessmentForm();
    updateSubmitButton();
  </script>
</body>
</html>
